function ShowHide(e) {
//    console.log(e);

    if (e.classList.contains('sbar')) {
        console.log('sbar');
        ShowHide_sbar(e);
    }
    if (e.classList.contains('shcart')) {
        console.log('shcart');
        ShowHide_shcart(e);
    }
}

function ShowHide_sbar(e) {
    var app = document.getElementById("app");
    var is_active = app.getAttribute('data-sbar-is_active');
    if (is_active === undefined) {
        app.setAttribute('data-sbar-is_active', 1);
    } else {
        if (parseInt(is_active) === 1) {
            app.setAttribute('data-sbar-is_active', 0);
        } else {
            app.setAttribute('data-sbar-is_active', 1);
        }
    }
    if (parseInt(app.getAttribute('data-sbar-is_active')) === 1) {
        document.getElementById("sbar_topbtn").style.width = "320px";
        var main = document.getElementById("main");
        main.style.marginLeft = "1px";
        var y = main.getElementsByClassName("hamburger");
        var i;
        for (i = 0; i < y.length; i++) {
            y[i].classList.add('active');
        }
    } else {
        document.getElementById("sbar_topbtn").style.width = "0px";
        var main = document.getElementById("main");
        main.style.marginLeft = "0px";
        var y = main.getElementsByClassName("hamburger");
        var i;
        for (i = 0; i < y.length; i++) {
            y[i].classList.remove('active');
        }
    }
}
function ShowHide_shcart(is_err, msg) {
    clearTimeout(ShowHide_shcart_timeout);

    var app = document.getElementById("app");
    var is_active = app.getAttribute('data-shcart-is_active');
    if (is_active === undefined) {
        app.setAttribute('data-shcart-is_active', 1);
    } else {
        if (parseInt(is_active) === 1) {
            app.setAttribute('data-shcart-is_active', 0);
        } else {
            app.setAttribute('data-shcart-is_active', 1);
        }
    }
    parseInt(app.getAttribute('data-shcart-is_active')) === 1 ?
            (
                    (document.getElementById("shcart_topbtn").style.width = "320px"),
                    (document.getElementById("main__shoop").style.marginLeft = "1px"),
                    openCanvas(is_err, msg)
//                    (document.body.style.backgroundColor = "rgba(0,0,0,0.4)"),
                    )
            : (
                    (document.getElementById("shcart_topbtn").style.width = "0px"),
                    (document.getElementById("main__shoop").style.marginLeft = "0px"),
                    closeOffcanvas()
//                    (document.body.style.backgroundColor = "white"),
                    );
}
function openCanvas(is_err, msg) {
    document.getElementById("bodyCanvasNav").style.width = "100%";
    document.getElementById("bodyCanvasNav").style.opacity = "0.8";
    if (msg !== undefined) {
        document.getElementById("bodyCanvasNav_msg").innerHTML = msg;
        if (!is_err) {
            $("#bodyCanvasNav_msg").removeClass("success failed").addClass("success");
        } else {
            $("#bodyCanvasNav_msg").removeClass("success failed").addClass("failed");
        }
    }
}
function closeOffcanvas() {
    clearTimeout(ShowHide_shcart_timeout);
    document.getElementById("bodyCanvasNav").style.width = "0%";
    document.getElementById("bodyCanvasNav").style.opacity = "0";
    document.getElementById("bodyCanvasNav_msg").innerHTML = '';
    $("#bodyCanvasNav_msg").removeClass("success failed");
}
function showOptions(o) {
    var item_id = o.getAttribute('data-item_id');
    console.log("item_id=" + item_id);
    MicroModal.show('modal-' + item_id);
//    document.getElementById('app').dataset.is_modal = true;
//    document.getElementById('app').dataset.modal_id = 'modal-' + item_id;

//    try {
//
//        MicroModal.init({
//            awaitCloseAnimation: true, // set to false, to remove close animation
//            onShow: function (modal) {
//                console.log("micromodal open");
//            },
//            onClose: function (modal) {
//                console.log("micromodal close");
//            }
//        });
//
//    } catch (e) {
//        console.log("micromodal error: ", e);
//    }
}

function showInfo(o, e) {
    var data_mah = o.getAttribute('data-mah');
    console.log("mah=" + data_mah);
    MicroModal.show('modal-mah-' + data_mah);
}

/*
 * click on div
 */
function fSelectInput(o, ischeckedArg, verifycntVal) {
    var ElementID = o.getAttribute("id");
    console.log('Clicked id=' + ElementID + '\ndata-id=' + o.getAttribute("data-id"));
    var oInput = $('input[id="iopt_select_' + ElementID + '"]');
    console.log('input', oInput);
    var ItemID = oInput[0].dataset.item_id;
    console.log('ItemID=' + ItemID);

    var ischecked;
    if (ischeckedArg !== undefined && ischeckedArg !== null) {
        ischecked = ischeckedArg;
    } else {
        ischecked = !oInput.data("state");
    }
    oInput.data("state", ischecked);
    oInput.prop('checked', ischecked);
    if (verifycntVal !== undefined && verifycntVal && oInput[0] !== undefined) {
        if (oInput[0].type === 'checkbox') {
            var oText = $('input[id="cnt-' + ElementID + '"]');
            if (oText.length < 1) {
                oInput.data("cnt", 1);
                oInput.attr("data-cnt", 1);
            } else {
                if (ischecked) {
                    var vval = oText.val();
                    if (oText.val().length === 0) {
                        oText.val(1);
                        oInput.data("cnt", 1);
                        oInput.attr("data-cnt", 1);
                    }
                } else {
                    oText.val("");
                    oInput.data("cnt", 0);
                    oInput.attr("data-cnt", 0);
                }
            }
        } else if (oInput[0].type === 'radio') {
//                console.log("oInput.is('radio')");
        }
    }
    changeAmount(ItemID);
}
function changeAmount(ItemID) {
    var o_options = $('[data-item_id="' + ItemID + '"]');
    var opt_amnt = 0;
    for (var i = 0; i < o_options.length; i++) {
        var curr = o_options[i];
        if ((curr.type === "radio" || curr.type === "checkbox") && curr.checked) {
            if (curr.dataset.iamnt) {
                if (curr.dataset.cnt !== undefined && Number(curr.dataset.cnt) > 0) {
                    opt_amnt += Number(curr.dataset.iamnt) * Number(curr.dataset.cnt);
                    console.log("*** Number(curr.dataset.iamnt) * Number(curr.dataset.cnt) =" + opt_amnt + " curr.id=" + curr.id);
                } else {
                    opt_amnt += Number(curr.dataset.iamnt);
                    console.log("*** Number(curr.dataset.iamnt) =" + opt_amnt);
                }
            } else {
                console.log("*** curr.dataset.iamnt=null");
            }
        }
    }

    console.log("looking for " + 'div[id="pamount.' + ItemID + '"]');

    var o_pamount = $('div[id="pamount.' + ItemID + '"]');
    var amountOrig = o_pamount[0].dataset.amount_orig;
    var namountOrig = Number(amountOrig);
    var amount = parseFloat(namountOrig + opt_amnt).toFixed(2);
//    document.getElementById("pamount." + ItemID).innerHTML = '$' + amount;
    document.getElementById("modal_amnt." + ItemID).innerHTML = '$' + amount;
//
//    var aaa = $("a[data-item_id='" + ItemID + "']");
//    $("a[data-item_id='" + ItemID + "']").data("amount", amount);
//    console.log("amount=" + amount);

//    var o = $("a[data-item_id='" + ItemID + "']");
//    console.log('o=', o);
//    o[0].dataset.amount = amount;

//    $("a[data-item_id='" + ItemID + "']")[0].dataset.amount = amount;
    $("button[data-item_id='" + ItemID + "']")[0].dataset.amount = amount;
    console.log("opt_amnt=" + opt_amnt + " o_pamount.data-amount_orig=" + amountOrig + " o_pamount:", o_pamount[0] + " namountOrig=" + namountOrig + " amount=" + amount);
}

function click_on_click(o) {
    var ihash = o.getAttribute("data-item_id");
    var element_id = o.getAttribute("data-element_id");
    var obj = $('button#' + ihash);
    console.log("click obj=", obj);
    put2basket(obj[0], true, false);
//    MicroModal.close('modal-' + element_id);
}

function productClick(o, e) {



    if (e) {
        console.log("click e.target.className=" + e.target.className + " o=", o);
        if (e.target.tagName === 'BUTTON') {
            put2basket(e.target, true);
            e.preventDefault();
            e.stopPropagation()
            return false;
        } else if (e.target.tagName === 'A' && e.target.dataset.cmd === 'showQR') {
            console.log("Show modal QR");
            $('#modal-show-qr-title').html(e.target.dataset.title);
            $('#modal-show-qr-img_id').attr("data-bsrc", o.dataset.item_id);
            $('#modal-show-qr-img_id').attr('src', 'qr.html?id=' + o.dataset.item_id);
            $('#modal-show-qr-img_id').attr('alt', e.target.dataset.title);

            MicroModal.show('modal-show-qr');
            return false;
        } else if (e.target.tagName === 'DIV' && !e.target.classList.contains('modal__overlay')) {
            var x = document.querySelectorAll('[aria-hidden="false"]');
            if (x.length < 1) {
                if (o.dataset.href !== undefined) {
                    window.location = o.dataset.href;
                    return false;
                }
            } else {
                console.log("modal is open");
                e.preventDefault();
                e.stopPropagation()
                return false;
            }
        }
    } else if (o.tagName === 'BUTTON') {
        //    if ((e == undefined || e === null) && e.tagName === 'BUTTON') {

        console.log("click o=", o);
        put2basket(o, true, false);
        return false;
    }
}